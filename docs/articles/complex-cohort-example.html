<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>complex-cohort-example • Capr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="complex-cohort-example">
<meta property="og:description" content="Capr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Capr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/CAPR_tutorial.html">CAPR_tutorial</a>
    </li>
    <li>
      <a href="../articles/Capr_Attributes_Extended.html">Capr_Attributes_Extended</a>
    </li>
    <li>
      <a href="../articles/complex-cohort-example.html">complex-cohort-example</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://ohdsi.github.io/Hades"><img src='https://ohdsi.github.io/Hades/images/hadesMini.png' width=80 height=17 style='vertical-align: top;'></a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="complex-cohort-example_files/header-attrs-2.9/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>complex-cohort-example</h1>
            
      
      
      <div class="hidden name"><code>complex-cohort-example.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>Capr is helpful for cohort definition creation because components of a cohort definition can be split into isolated objects, independent of the full cohort definition. Using Capr, we can now construct smaller pieces of the cohort definition such as queries, counts or groups that can be reincorportated across the cohort definition. The idea of reusable component parts is to construct smaller and simpler objects that can be saved to disk (or in the global environment) to be used as an input to a more complex feature of the cohort definition. In this vignette, we show how we can leverage Capr to create complex cohorts and lay the foundations for more advanced use cases like cohort templating.</p>
<p>The example detailed in this vignette follows follows a complex cohort definition creation example detailed in the following <a href="https://www.youtube.com/watch?v=2d0qLHEzVYU&amp;ab_channel=ChrisKnoll">video</a>. Our goal is to create the <a href="https://phekb.org/phenotype/type-2-diabetes-mellitus">PheKB type 2 diabetes cohort definition</a> that contains five paths that logically defines a case of type 2 diabetes. In this example we construct smaller pieces of the cohort definition that we can reuse during the construction of the cohort.</p>
<p>The PheKB Type 2 Diabetes Mellitus cohort definition is described by the flowchart:</p>
<p><img src="../../../../../../tmp/RtmpEK4NDd/temp_libpath11f11a25ace1ca/Capr/images/t2d_001.png" width="192"></p>
<p>To build this cohort we first start with a initial set of presumed cases of T2DM. Patient initially in this cohort must have all of the following: a diagnosis of T2DM (T2Dx), a prescribed medication for T2DM (T2Rx), and presence of an abnormal lab for T2DM. An abnormal lab can be described by any of: <span class="math inline">\(\geq 125\)</span> mg/dl for fasting glucose, <span class="math inline">\(\geq 200\)</span> mg/dl for random glucose or <span class="math inline">\(\geq6\%\)</span> for HbA1c. From this initial set we need to restrict initial events to not included persons with a type 1 Diabetes diagnosis. With this a set of presumed cases, we can now confirm T2DM diagnosis using an algorithm composed of 5 pathways based on the above figure:</p>
<p>Path 1: exactly 0 T2Dx, at least 1 T2Rx and at least 1 AbLab</p>
<p>Path 2: at least 1 T2Dx, exactly 0 T1Rx, exactly 0 T2Rx, and at least 1 AbLab</p>
<p>Path 3: at least 1 T2Dx, exactly 0 T1Rx, and at least 1 T2Rx</p>
<p>Path 4: at least 1 T2Dx, at least 1 T1Rx, at least 1T2Rx, and at least 1 occurrence of T2Rx before T1Rx</p>
<p>Path 5: at least 1 T2Dx, at least 1 T1Rx, exactly 0 T2Rx and at least 2 T2Dx</p>
<p>These inclusion rules restrict our initial event, ensuring that we are only recruiting patients with a confirmed T2DM case. In this vignette we outline the process of creating this cohort in Capr.</p>
</div>
<div id="setup" class="section level2">
<h2 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h2>
<p>Before we start using Capr, we must load it as a dependent package in R and set up a connection to an OMOP database using <code>DatabaseConnector</code>. In order to use Capr’s lookup functions, one needs to be connected to an OMOP database with up-to-date vocabulary tables. This helps us find all the concept information, map descendants, and map to the standard concept for cohort definition queries. This setup should be at the top of all Capr scripts to be referenced throughout.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">Capr</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ohdsi.github.io/DatabaseConnector/">DatabaseConnector</a></span><span class="op">)</span>

<span class="co">#set database connection details</span>
<span class="va">connectionDetails</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/createConnectionDetails.html">createConnectionDetails</a></span><span class="op">(</span>
  dbms <span class="op">=</span> <span class="st">"postgresql"</span>,
  server <span class="op">=</span> <span class="st">"example.com/datasource"</span>,
  user <span class="op">=</span> <span class="st">"me"</span>,
  password <span class="op">=</span> <span class="st">"secret"</span>,
  port <span class="op">=</span> <span class="st">"5432"</span><span class="op">)</span>

<span class="co">#set connection</span>
<span class="va">connection</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/connect.html">connect</a></span><span class="op">(</span><span class="va">connectionDetails</span><span class="op">)</span>
<span class="co">#identify vocabulary schema</span>
<span class="va">vocabularyDatabaseSchema</span> <span class="op">&lt;-</span> <span class="st">"vocab"</span></code></pre></div>
</div>
<div id="building-concept-set-expressions" class="section level2">
<h2 class="hasAnchor">
<a href="#building-concept-set-expressions" class="anchor"></a>Building Concept Set Expressions</h2>
<p>The first step in cohort creation is to identify medical concepts of interest that capture possible occurrence of type 2 diabetes, for example. Concept set expressions are a fundamental building block to the cohort definition because they group together all codes used to capture a common medical term and establish hierarchical relationships between these sets of codes. As an example, let’s say we are interested in all Type 2 Diabetes medications. We want to capture metformin and glipizide and all other medications used prescribed for Type 2 Diabetes. We can group these together as a single concept set. But what about if there are different brands or dosages of these medications, how do we include all of them? For this we need to establish a descendant relationship between the root concept of the ingredient with all its child concepts describing variations on the same ingredient. The concept set expression bundles together codes for all Type 2 Diabetes medications and inherits the descendant concepts used to describe different formulations of the ingredients. We now have a thorough list of all concepts used to describe medications prescribed for Type 2 Diabetes Mellitus. One should refer to documentation on the OMOP vocabularies and concept set creation for more in-depth explanation. Whenever a cohort definition is built, we typically start by identifying the concept set expressions. For the type 2 diabetes cohort we need to identify the following concept set expressions:</p>
<ol style="list-style-type: decimal">
<li><p>Diagnosis of Type 2 Diabetes (T2Dx)</p></li>
<li><p>Medications prescribed for Type 2 Diabetes (T2Rx)</p></li>
<li><p>Abnormal lab measurements indicating difficulty regulating glucose defined by:</p></li>
</ol>
<ul>
<li><p>random glucose <span class="math inline">\(&gt; 200 mg/dl\)</span></p></li>
<li><p>fasting glucose <span class="math inline">\(\geq 125 mg/dl\)</span></p></li>
<li><p>HbA1c <span class="math inline">\(\geq 6\%\)</span></p></li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li><p>Diagnosis of Type 1 Diabetes (T1Dx)</p></li>
<li><p>Medications prescribed for Type 1 Diabetes (T1Rx)</p></li>
</ol>
<p>Using Capr we start by looking for the concepts required for each of these expressions. Capr allows a user to lookup keywords in the OMOP vocabularies, however for simplicity we pre-identified the concept ids for the example code below. Notice how in the code chunks below we heavily rely on forward piping. The pipe takes the output of the function from the left hand side (lhs) and uses it as the input for a function on the right hand side (rhs). For those familiar with the command line, this is the same logic as piping in bash and something we want to embrace in a functional programming language like R.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Type 2 Diabetes Diagnosis</span>
<span class="va">T2Dx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getConceptIdDetails.html">getConceptIdDetails</a></span><span class="op">(</span>
  conceptIds <span class="op">=</span> <span class="fl">201826</span>,
  connection <span class="op">=</span> <span class="va">connection</span>,
  vocabularyDatabaseSchema <span class="op">=</span> <span class="va">vocabularyDatabaseSchema</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/createConceptSetExpression.html">createConceptSetExpression</a></span><span class="op">(</span>
    Name <span class="op">=</span> <span class="st">"Type 2 Diabetes Diagnosis"</span>,
    includeDescendants <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co">#Type 2 Diabetes Medications concept IDS</span>
<span class="va">T2RxIds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1502809L</span>, <span class="fl">1502826L</span>, <span class="fl">1503297L</span>, <span class="fl">1510202L</span>, 
             <span class="fl">1515249L</span>, <span class="fl">1516766L</span>, <span class="fl">1525215L</span>, <span class="fl">1529331L</span>, 
             <span class="fl">1530014L</span>, <span class="fl">1547504L</span>, <span class="fl">1559684L</span>, <span class="fl">1560171L</span>, 
             <span class="fl">1580747L</span>, <span class="fl">1583722L</span>, <span class="fl">1594973L</span>, <span class="fl">1597756L</span><span class="op">)</span>

<span class="co">#create concept set expression</span>
<span class="va">T2Rx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getConceptIdDetails.html">getConceptIdDetails</a></span><span class="op">(</span>
  conceptIds <span class="op">=</span> <span class="va">T2RxIds</span>,
  connection <span class="op">=</span> <span class="va">connection</span>,
   vocabularyDatabaseSchema <span class="op">=</span> <span class="va">vocabularyDatabaseSchema</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/createConceptSetExpression.html">createConceptSetExpression</a></span><span class="op">(</span>
    Name <span class="op">=</span> <span class="st">"Type 2 Diabetes Medications"</span>,
    includeDescendants <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co">#Type 1 Diabetes Diagnosis</span>
<span class="va">T1Dx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getConceptIdDetails.html">getConceptIdDetails</a></span><span class="op">(</span>
  conceptIds <span class="op">=</span> <span class="fl">201254</span>,
  connection <span class="op">=</span> <span class="va">connection</span>,
  vocabularyDatabaseSchema <span class="op">=</span> <span class="va">vocabularyDatabaseSchema</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/createConceptSetExpression.html">createConceptSetExpression</a></span><span class="op">(</span>
    Name <span class="op">=</span> <span class="st">"Type 1 Diabetes Diagnosis"</span>,
    includeDescendants <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>Sometimes it is more convenient to use concept codes from a given vocabulary instead of the concept ids. The OMOP vocabularies allow us to look up concepts from both standard and non-standard vocabularies using their original codes. We can map these codes to standard and find the concept ids used for OMOP queries. Below we show code that looks up concept codes and forms the concept set expression used for the cohort definition.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Type 1 Diabetes Medications</span>
<span class="va">T1DRxNormCodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">139825</span>,<span class="fl">274783</span>,<span class="fl">314684</span>,
                          <span class="fl">352385</span>,<span class="fl">400008</span>,<span class="fl">51428</span>,
                          <span class="fl">5856</span>,<span class="fl">86009</span>,<span class="fl">139953</span><span class="op">)</span><span class="op">)</span>
<span class="va">T1Rx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getConceptCodeDetails.html">getConceptCodeDetails</a></span><span class="op">(</span>
  conceptCode <span class="op">=</span> <span class="va">T1DRxNormCodes</span>,
  vocabulary <span class="op">=</span> <span class="st">"RxNorm"</span>,
  connection <span class="op">=</span> <span class="va">connection</span>,
  vocabularyDatabaseSchema <span class="op">=</span> <span class="va">vocabularyDatabaseSchema</span>,
  mapToStandard <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/createConceptSetExpression.html">createConceptSetExpression</a></span><span class="op">(</span>
    Name <span class="op">=</span> <span class="st">"Type 1 Diabetes Medications"</span>,
    includeDescendants <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co">#Abnormal Lab</span>
<span class="va">AbLabHbA1c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"4548-4"</span>, <span class="st">"17856-6"</span>, <span class="st">"4549-2"</span>, <span class="st">"17855-8"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/getConceptCodeDetails.html">getConceptCodeDetails</a></span><span class="op">(</span>
    conceptCode <span class="op">=</span> <span class="va">.</span>, <span class="co">#places the lhs vector to the rhs of the pipe</span>
    vocabulary <span class="op">=</span> <span class="st">"LOINC"</span>,
    connection <span class="op">=</span> <span class="va">connection</span>,
    vocabularyDatabaseSchema <span class="op">=</span> <span class="va">vocabularyDatabaseSchema</span>,
    mapToStandard <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/createConceptSetExpression.html">createConceptSetExpression</a></span><span class="op">(</span>
    Name <span class="op">=</span> <span class="st">"Abnormal Lab HbA1c"</span>,
    includeDescendants <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co">#Ab Lab for Random Glucose (&gt;= 200 mg/dl)</span>
<span class="va">AbLabRandomGluc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2339-0"</span>, <span class="st">"2345-7"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/getConceptCodeDetails.html">getConceptCodeDetails</a></span><span class="op">(</span>
    conceptCode <span class="op">=</span> <span class="va">.</span>, 
    vocabulary <span class="op">=</span> <span class="st">"LOINC"</span>,
    connection <span class="op">=</span> <span class="va">connection</span>,
    vocabularyDatabaseSchema <span class="op">=</span> <span class="va">vocabularyDatabaseSchema</span>,
    mapToStandard <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/createConceptSetExpression.html">createConceptSetExpression</a></span><span class="op">(</span>
    Name <span class="op">=</span> <span class="st">"Abnormal Lab Random Glucose"</span>,
    includeDescendants <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co">#Ab Lab for Fasting Glucose (&gt;= 125 mg/dl)</span>

<span class="va">AbLabFastingGluc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1558-6"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/getConceptCodeDetails.html">getConceptCodeDetails</a></span><span class="op">(</span>
    conceptCode <span class="op">=</span> <span class="va">.</span>,
    vocabulary <span class="op">=</span> <span class="st">"LOINC"</span>,
    connection <span class="op">=</span> <span class="va">connection</span>,
    vocabularyDatabaseSchema <span class="op">=</span> <span class="va">vocabularyDatabaseSchema</span>,
    mapToStandard <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/createConceptSetExpression.html">createConceptSetExpression</a></span><span class="op">(</span>
    Name <span class="op">=</span> <span class="st">"Abnormal Lab Fasting Glucose"</span>,
    includeDescendants <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
<div id="building-queries" class="section level2">
<h2 class="hasAnchor">
<a href="#building-queries" class="anchor"></a>Building Queries</h2>
<p>The next building block of a cohort definition is a query. A query, as defined in the context of circe and Capr, provides the mechanism for identifying an observational event in the CDM. By identifying a domanin we can search for presence of a concept (and its descendants) within the clinical tables of the CDM. For example if we wanted to look for presence of a type 2 diabetes diagnosis we would search the condition occurrence domain for any matches with the Type 2 diabetes concept set expression. In Capr, the signature for creating a query includes the domain from which we wish to query. A concept set expression is typically attached to the query and sometimes can be modified by a list of attributes.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co">#T2Rx Drug Exposure Query </span>
<span class="va">T2RxQuery</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createDrugExposure.html">createDrugExposure</a></span><span class="op">(</span>conceptSetExpression <span class="op">=</span> <span class="va">T2Rx</span><span class="op">)</span>


<span class="co">#T1Rx Drug Exposure Query</span>
<span class="va">T1RxQuery</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createDrugExposure.html">createDrugExposure</a></span><span class="op">(</span>conceptSetExpression <span class="op">=</span> <span class="va">T1Rx</span><span class="op">)</span>


<span class="co">#T2Dx Condition Occurrence Query</span>
<span class="va">T2DxQuery</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createConditionOccurrence.html">createConditionOccurrence</a></span><span class="op">(</span>conceptSetExpression <span class="op">=</span> <span class="va">T2Dx</span><span class="op">)</span>


<span class="co">#T1Dx Condition Occurrence Query</span>
<span class="va">T1DxQuery</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createConditionOccurrence.html">createConditionOccurrence</a></span><span class="op">(</span>conceptSetExpression <span class="op">=</span> <span class="va">T1Dx</span><span class="op">)</span></code></pre></div>
<p>For the Abnormal labs, there are 3 values that indicate an abnormal level based on the type of measurement. We need to create an attribute with the measurement query for the abnormal lab establishing a threshold for which we can create a binary indicator for presence.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#HbA1c Query with value attribute</span>
<span class="va">AbLabHbA1cQuery</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createMeasurement.html">createMeasurement</a></span><span class="op">(</span>
  conceptSetExpression <span class="op">=</span> <span class="va">AbLabHbA1c</span>,
  attributeList <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="co">#add attribute of &gt;= 6% HbA1c</span>
  <span class="fu"><a href="../reference/createValueAsNumberAttribute.html">createValueAsNumberAttribute</a></span><span class="op">(</span>Op <span class="op">=</span> <span class="st">"gte"</span>, Value <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>
  <span class="op">)</span><span class="op">)</span>

<span class="co">#RandomGluc Query with value attribute</span>
<span class="va">AbLabRandomGlucQuery</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createMeasurement.html">createMeasurement</a></span><span class="op">(</span>
  conceptSetExpression <span class="op">=</span> <span class="va">AbLabRandomGluc</span>,
  attributeList <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="co">#add attribute of &gt;= 200 mg/dl</span>
  <span class="fu"><a href="../reference/createValueAsNumberAttribute.html">createValueAsNumberAttribute</a></span><span class="op">(</span>Op <span class="op">=</span> <span class="st">"gte"</span>, Value <span class="op">=</span> <span class="fl">200L</span><span class="op">)</span>
<span class="op">)</span><span class="op">)</span>
 
<span class="co">#FastingGluc Query with value attribute</span>
<span class="va">AbLabFastingGlucQuery</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createMeasurement.html">createMeasurement</a></span><span class="op">(</span>
  conceptSetExpression <span class="op">=</span> <span class="va">AbLabFastingGluc</span>,
  attributeList <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="co">#add attribute of &gt;= 125 mg/dl</span>
  <span class="fu"><a href="../reference/createValueAsNumberAttribute.html">createValueAsNumberAttribute</a></span><span class="op">(</span>Op <span class="op">=</span> <span class="st">"gte"</span>, Value <span class="op">=</span> <span class="fl">125L</span><span class="op">)</span>
<span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="creating-counts-from-queries" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-counts-from-queries" class="anchor"></a>Creating Counts from Queries</h2>
<p>A query looks through a domain and verifies the presence of a concept set expression, modified by the presence of an attribute. What a query lacks is temporal and enumeration logic along a patient timeline. A count component modifies the query to check for the number of occurrences along a temporal spectrum. For example, in our type 2 diabetes pathways we need may need to identify presence of a Type 1 Diabetes medication to confirm the diagnosis. So we need to modify the query for type 1 diabetes medications to ensure that we are counting only those patients who do not have a medication following the initial entry event. Recall the pathways had a series of conditions that all needed to be observed in order for a patient to count within a pathway.</p>
<p>Ex. Path 1: exactly 0 T2Dx, at least 1 T2Rx and at least 1 AbLab</p>
<p>Each item within the pathway is a count. THe count is ensuring we have identified a query by set number of occurrences within a timeline.</p>
<p>For counts in the T2DM phenotype, we set a standard timeline of all days before the initial event and 0 days after the initial event. This means that we want to count events that may have occured anytime before and on the same day, nothing after.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#create timeline</span>
<span class="va">tl1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createTimeline.html">createTimeline</a></span><span class="op">(</span>StartWindow <span class="op">=</span> <span class="fu"><a href="../reference/createWindow.html">createWindow</a></span><span class="op">(</span>
  StartDays <span class="op">=</span> <span class="st">"All"</span>, StartCoeff <span class="op">=</span> <span class="st">"Before"</span>, 
  EndDays <span class="op">=</span> <span class="fl">0L</span>, EndCoeff <span class="op">=</span> <span class="st">"After"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Now we can create all the events that take place in this time frame. When we create a count we quantify the occurence of medical events. Either they never happened, they occurred at least once or they occurred at least twice. For each patient, we need to verify that these medical events have been properly observed in order for inclusion. Below we create the sets of counts needed for each pathway.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#no occurrence of T1 Diabetes</span>
<span class="va">noT1DxCount</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCount.html">createCount</a></span><span class="op">(</span>Query <span class="op">=</span> <span class="va">T1DxQuery</span>, 
                           Logic <span class="op">=</span> <span class="st">"exactly"</span>,
                           Count <span class="op">=</span> <span class="fl">0L</span>,
                           Timeline <span class="op">=</span> <span class="va">tl1</span><span class="op">)</span>

<span class="co">#no occurrence of T2 Diabetes</span>
<span class="va">noT2DxCount</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCount.html">createCount</a></span><span class="op">(</span>Query <span class="op">=</span> <span class="va">T2DxQuery</span>, 
                           Logic <span class="op">=</span> <span class="st">"exactly"</span>,
                           Count <span class="op">=</span> <span class="fl">0L</span>,
                           Timeline <span class="op">=</span> <span class="va">tl1</span><span class="op">)</span>


<span class="co">#at least 1 occurrence of T2 Diabetes</span>
<span class="va">atLeast1T2DxCount</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCount.html">createCount</a></span><span class="op">(</span>Query <span class="op">=</span> <span class="va">T2DxQuery</span>, 
                                 Logic <span class="op">=</span> <span class="st">"at_least"</span>,
                                 Count <span class="op">=</span> <span class="fl">1L</span>,
                                 Timeline <span class="op">=</span> <span class="va">tl1</span><span class="op">)</span>

<span class="co">#at least 2 occurrence of T2 Diabetes</span>
<span class="va">atLeast2T2DxCount</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCount.html">createCount</a></span><span class="op">(</span>Query <span class="op">=</span> <span class="va">T2DxQuery</span>, 
                                 Logic <span class="op">=</span> <span class="st">"at_least"</span>,
                                 Count <span class="op">=</span> <span class="fl">2L</span>,
                                 Timeline <span class="op">=</span> <span class="va">tl1</span><span class="op">)</span>

<span class="co">##################</span>
<span class="co">#Medication Counts</span>
<span class="co">##################</span>


<span class="co">#at least 1 T2DM medication </span>
<span class="va">atLeast1T2RxCount</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCount.html">createCount</a></span><span class="op">(</span>Query <span class="op">=</span> <span class="va">T2RxQuery</span>, 
                                 Logic <span class="op">=</span> <span class="st">"at_least"</span>,
                                 Count <span class="op">=</span> <span class="fl">1L</span>,
                                 Timeline <span class="op">=</span> <span class="va">tl1</span><span class="op">)</span>

<span class="co">#no exposure to T2DM medication </span>
<span class="va">noT2RxCount</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCount.html">createCount</a></span><span class="op">(</span>Query <span class="op">=</span> <span class="va">T2RxQuery</span>, 
                           Logic <span class="op">=</span> <span class="st">"exactly"</span>,
                           Count <span class="op">=</span> <span class="fl">0L</span>,
                           Timeline <span class="op">=</span> <span class="va">tl1</span><span class="op">)</span>

<span class="co">#at least 1 T1DM medication </span>
<span class="va">atLeast1T1RxCount</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCount.html">createCount</a></span><span class="op">(</span>Query <span class="op">=</span> <span class="va">T1RxQuery</span>, 
                                 Logic <span class="op">=</span> <span class="st">"at_least"</span>,
                                 Count <span class="op">=</span> <span class="fl">1L</span>,
                                 Timeline <span class="op">=</span> <span class="va">tl1</span><span class="op">)</span>

<span class="co">#no exposure to T1DM medication </span>
<span class="va">noT1RxCount</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCount.html">createCount</a></span><span class="op">(</span>Query <span class="op">=</span> <span class="va">T1RxQuery</span>, 
                           Logic <span class="op">=</span> <span class="st">"exactly"</span>,
                           Count <span class="op">=</span> <span class="fl">0L</span>,
                           Timeline <span class="op">=</span> <span class="va">tl1</span><span class="op">)</span>

<span class="co">#################</span>
<span class="co">#AbLab Counts</span>
<span class="co">#################</span>

<span class="co">#at least 1 abnormal HbA1c Lab</span>
<span class="va">atLeast1AbLabHbA1cCount</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCount.html">createCount</a></span><span class="op">(</span>Query <span class="op">=</span> <span class="va">AbLabHbA1cQuery</span>, 
                                       Logic <span class="op">=</span> <span class="st">"at_least"</span>,
                                       Count <span class="op">=</span> <span class="fl">1L</span>,
                                       Timeline <span class="op">=</span> <span class="va">tl1</span><span class="op">)</span>

<span class="co">#at least 1 abnormal Fasting Glucose Lab</span>
<span class="va">atLeast1AbLabFastingGlucCount</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCount.html">createCount</a></span><span class="op">(</span>Query <span class="op">=</span> <span class="va">AbLabFastingGlucQuery</span>, 
                                             Logic <span class="op">=</span> <span class="st">"at_least"</span>,
                                             Count <span class="op">=</span> <span class="fl">1L</span>,
                                             Timeline <span class="op">=</span> <span class="va">tl1</span><span class="op">)</span>

<span class="co">#at least 1 abnormal Random Glucose Lab</span>
<span class="va">atLeast1AbLabRandomGlucCount</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCount.html">createCount</a></span><span class="op">(</span>Query <span class="op">=</span> <span class="va">AbLabRandomGlucQuery</span>, 
                                            Logic <span class="op">=</span> <span class="st">"at_least"</span>,
                                            Count <span class="op">=</span> <span class="fl">1L</span>,
                                            Timeline <span class="op">=</span> <span class="va">tl1</span><span class="op">)</span></code></pre></div>
</div>
<div id="creating-the-initial-cohort-entry" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-the-initial-cohort-entry" class="anchor"></a>Creating the Initial Cohort Entry</h2>
<p>With the components created above we can set the initial cohort entry. We defined initial entry as observed occurrence of all of the following events: T2DM diagnosis, prescription of a T2DM medication and the presence of an abnormal lab. In OHDSI the initial recruiting point is called the primary criteria. The primary criteria only searches on queries and is bounded by an observation window distinguishing the minimal amount of continuous observation for the patient to be included.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">PrimaryCriteria</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createPrimaryCriteria.html">createPrimaryCriteria</a></span><span class="op">(</span>
  Name <span class="op">=</span> <span class="st">"PC for T2DM Case Phenotype"</span>,
  ComponentList <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">T2DxQuery</span>,<span class="va">T2RxQuery</span>,<span class="va">AbLabHbA1cQuery</span>,
                       <span class="va">AbLabFastingGlucQuery</span>,<span class="va">AbLabRandomGlucQuery</span><span class="op">)</span>,
  ObservationWindow <span class="op">=</span> <span class="fu"><a href="../reference/createObservationWindow.html">createObservationWindow</a></span><span class="op">(</span>
    PriorDays <span class="op">=</span> <span class="fl">0L</span>,
    PostDays <span class="op">=</span> <span class="fl">0L</span>
  <span class="op">)</span>,
  Limit <span class="op">=</span> <span class="st">"All"</span><span class="op">)</span></code></pre></div>
<p>Recall that we do not want anyone in the cohort to have had a Type 1 Diabetes diagnosis at any time before the primary criteria. We can restrict the initial event through an additional criteria, which defines a group of counts that we wish to exclude from the initial event. An addtional criteria requires a group component input in Capr. Groups will be explained more in the next section.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#No T1Dx at any point in patient history</span>
<span class="va">NoT1DxGroup</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createGroup.html">createGroup</a></span><span class="op">(</span>Name <span class="op">=</span> <span class="st">"No Diagnosis of Type 1 Diabetes"</span>,
                           type <span class="op">=</span> <span class="st">"ALL"</span>,
                           criteriaList <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">noT1DxCount</span><span class="op">)</span><span class="op">)</span>

<span class="co">#create additional Criteria</span>
<span class="co">#further restrict the initial capture to people with no T1Dx</span>
<span class="va">AdditionalCriteria</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createAdditionalCriteria.html">createAdditionalCriteria</a></span><span class="op">(</span>
  Name <span class="op">=</span> <span class="st">"AC for T2DM Case Phenotype"</span>,
  Contents <span class="op">=</span> <span class="va">NoT1DxGroup</span>,
  Limit <span class="op">=</span> <span class="st">"First"</span>
<span class="op">)</span></code></pre></div>
<p>With these two pieces of the cohort we have an initial set of T2DM patients who do no have T1DM. Next we need to confirm the T2DM cases to ensure inclusion into the cohort. In the next section we create the confirmatory pathways.</p>
</div>
<div id="creating-t2d-pathways-as-groups" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-t2d-pathways-as-groups" class="anchor"></a>Creating T2D Pathways as Groups</h2>
<p>In the previous section we alluded to the idea of a group component. Groups are a way of providing boolean logic to counts of events found by queries. In this example, we can bundle multiple counts together as a pathway. Another example of a group before getting to the pathways is the abnormal lab. In our example we don’t need the patient to have all the labs, just 1 abnormal lab of the set of three. From the abnormal lab counts created before, we only need 1 to be true for the person to be included in the cohort.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">atLeast1AbLabGroup</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createGroup.html">createGroup</a></span><span class="op">(</span>
  Name <span class="op">=</span> <span class="st">"Abnormal labs for HbA1c, Fasting+Random Glucose"</span>,
  type <span class="op">=</span> <span class="st">"ANY"</span>,
  criteriaList <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
      <span class="va">atLeast1AbLabHbA1cCount</span>,
      <span class="va">atLeast1AbLabFastingGlucCount</span>,
      <span class="va">atLeast1AbLabRandomGlucCount</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<p>Now that we have established all our pieces, we can build each pathway. For a patient to have a confirmed T2DM case they must have all conditions within a single pathway. For pathway 1 this would be no T2Dx, at least 1 T2Rx and at least 1 AbLab prior to the initial event.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co">#Path 1: 0 T2Dx, 1+ T2Rx and 1+ AbLab</span>
<span class="va">Pathway1T2DMGroup</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createGroup.html">createGroup</a></span><span class="op">(</span>
  Name <span class="op">=</span> <span class="st">"Pathway1"</span>,
  Description <span class="op">=</span> <span class="st">"0 T2Dx, 1+ T2Rx and 1+ AbLab"</span>,
  type <span class="op">=</span> <span class="st">"ALL"</span>,
  criteriaList <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">noT2DxCount</span>, <span class="va">atLeast1T2RxCount</span><span class="op">)</span>,
  Groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">atLeast1AbLabGroup</span><span class="op">)</span><span class="op">)</span>

<span class="co">#Path 2: 1+ T2Dx, 0 T1Rx, 0 T2Rx, and 1+ AbLab  </span>
<span class="va">Pathway2T2DMGroup</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createGroup.html">createGroup</a></span><span class="op">(</span>
  Name <span class="op">=</span> <span class="st">"Pathway2"</span>,
  Description <span class="op">=</span> <span class="st">"1+ T2Dx, 0 T1Rx, 0 T2Rx, and 1+ AbLab"</span>,
  type <span class="op">=</span> <span class="st">"ALL"</span>,
  criteriaList <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">atLeast1T2DxCount</span>, <span class="va">noT1RxCount</span>, <span class="va">noT2RxCount</span><span class="op">)</span>,
  Groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">atLeast1AbLabGroup</span><span class="op">)</span><span class="op">)</span>

<span class="co">#Path 3: 1+ T2Dx, 0 T1Rx, and 1+ T2Rx  </span>
<span class="va">Pathway3T2DMGroup</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createGroup.html">createGroup</a></span><span class="op">(</span>
  Name <span class="op">=</span> <span class="st">"Pathway3"</span>,
  Description <span class="op">=</span> <span class="st">"1+ T2Dx, 0 T1Rx, and 1+ T2Rx"</span>,
  type <span class="op">=</span> <span class="st">"ALL"</span>,
  criteriaList <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">atLeast1T2DxCount</span>, <span class="va">noT1RxCount</span>, <span class="va">atLeast1T2RxCount</span><span class="op">)</span>
<span class="op">)</span>

<span class="co">#Path 5: 1+ T2Dx, 1+ T1Rx, 0 T2Rx and 2+ T2Dx   </span>
<span class="va">Pathway5T2DMGroup</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createGroup.html">createGroup</a></span><span class="op">(</span>
  Name <span class="op">=</span> <span class="st">"Pathway5"</span>,
  Description <span class="op">=</span> <span class="st">"1+ T2Dx, 1+ T1Rx, 0 T2Rx and 2+ T2Dx"</span>,
  type <span class="op">=</span> <span class="st">"ALL"</span>,
  criteriaList <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">atLeast1T2DxCount</span>, <span class="va">atLeast1T1RxCount</span>,
                      <span class="va">noT2RxCount</span>, <span class="va">atLeast2T2DxCount</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Notice we omitted pathway 4. This is because pathway 4 has a special nested structure: a T2Rx must occur before a T1Rx. To create this nesting within T1Rx query, we require a special correlated criteria attribute. This attribute nests a group within a query, meaning that the query is only valid if the nested group is also true. In this case we want the timeline to be All days before and 1 day before, so that we are only counting T2Rx occuring before the T1Rx. The code chunk below shows how this nested criteria is created:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tl2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createTimeline.html">createTimeline</a></span><span class="op">(</span>StartWindow <span class="op">=</span> <span class="fu"><a href="../reference/createWindow.html">createWindow</a></span><span class="op">(</span>
  StartDays <span class="op">=</span> <span class="st">"All"</span>, StartCoeff <span class="op">=</span> <span class="st">"Before"</span>, 
  EndDays <span class="op">=</span> <span class="fl">1L</span>, EndCoeff <span class="op">=</span> <span class="st">"Before"</span><span class="op">)</span><span class="op">)</span>

<span class="va">PriorT2RxCount</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCount.html">createCount</a></span><span class="op">(</span>
  Query <span class="op">=</span> <span class="va">T2RxQuery</span>,
  Logic <span class="op">=</span> <span class="st">"at_least"</span>,
  Count <span class="op">=</span> <span class="fl">1L</span>,
  Timeline <span class="op">=</span> <span class="va">tl2</span>
<span class="op">)</span>

<span class="va">PriorT2RxNestedGroup</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCorrelatedCriteriaAttribute.html">createCorrelatedCriteriaAttribute</a></span><span class="op">(</span>
  <span class="fu"><a href="../reference/createGroup.html">createGroup</a></span><span class="op">(</span>
    Name <span class="op">=</span> <span class="st">"Nested Group T2Rx before T1Rx"</span>,
    type <span class="op">=</span> <span class="st">"ALL"</span>,
    criteriaList <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">PriorT2RxCount</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="va">T2RxBeforeT1RxCount</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createDrugExposure.html">createDrugExposure</a></span><span class="op">(</span>
  conceptSetExpression <span class="op">=</span> <span class="va">T1Rx</span>,
  attributeList <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">PriorT2RxNestedGroup</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/createCount.html">createCount</a></span><span class="op">(</span>Logic <span class="op">=</span> <span class="st">"at_least"</span>, Count <span class="op">=</span> <span class="fl">1L</span>,
              Timeline <span class="op">=</span> <span class="va">tl1</span><span class="op">)</span></code></pre></div>
<p>With this nested count in place we can build the 4th pathway, which requires at least 1 T2Dx, at least 1 T1Rx, at least 1 T2Rx, and the T2Rx to occur before the T1Rx.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Path 4: 1+ T2Dx, 1+ T1Rx, 1+T2Rx, and 1+ T2Rx &lt; T1Rx    </span>
<span class="va">Pathway4T2DMGroup</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createGroup.html">createGroup</a></span><span class="op">(</span>
  Name <span class="op">=</span> <span class="st">"Pathway4"</span>,
  Description <span class="op">=</span> <span class="st">"1+ T2Dx, 1+ T1Rx, 1+T2Rx, and 1+ T2Rx &lt; T1Rx"</span>,
  type <span class="op">=</span> <span class="st">"ALL"</span>,
  criteriaList <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">atLeast1T2DxCount</span>, <span class="va">atLeast1T1RxCount</span>,
                      <span class="va">T2RxBeforeT1RxCount</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Now we create the inclusion rules for this cohort. Based on the original entry set, we further restrict to only contain those that follow a set of rules. The patients only need to be in 1 of any of the pathways, thus the boolean for our group component is “any”.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#T2DM Case Group</span>
<span class="va">T2DMCase</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createGroup.html">createGroup</a></span><span class="op">(</span>
  Name <span class="op">=</span> <span class="st">"Case for T2DM using algorithm"</span>,
  type <span class="op">=</span> <span class="st">"ANY"</span>,
  Groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">Pathway1T2DMGroup</span>, <span class="va">Pathway2T2DMGroup</span>, <span class="va">Pathway3T2DMGroup</span>,
                <span class="va">Pathway4T2DMGroup</span>, <span class="va">Pathway5T2DMGroup</span><span class="op">)</span>
<span class="op">)</span>

<span class="co">#keep T2DM cases if they meet 1 of the 5 pathways</span>
<span class="va">InclusionRules</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createInclusionRules.html">createInclusionRules</a></span><span class="op">(</span>
  Name <span class="op">=</span> <span class="st">"IRs for T2DM Case Phenotype"</span>,
  Contents <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">T2DMCase</span><span class="op">)</span>,
  Limit <span class="op">=</span> <span class="st">"First"</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="finalizing-the-cohort-definition" class="section level2">
<h2 class="hasAnchor">
<a href="#finalizing-the-cohort-definition" class="anchor"></a>Finalizing the Cohort Definition</h2>
<p>In the cohort definition we have so far captured entry and restriction, but what about exit. A cohort is defined by an entry an exit so that we understand a patient’s time at risk. In this cohort exit may be defined in two parts: end of continuous observation (meaning the last recorded timestamp available) or a censoring event. If the patient were to be diagnosed with Type 1 Diabetes their events are no longer observed since they can not be a valid T2DM case. We can create a censoring criteria based on a query, shown in the code chunk below:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#person exits cohort if there is a diagnosis of T1DM</span>
<span class="va">CensoringCriteria</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCensoringCriteria.html">createCensoringCriteria</a></span><span class="op">(</span>
  Name <span class="op">=</span> <span class="st">"Censor of T1DM cases"</span>,
  ComponentList <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">T1DxQuery</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Now the cohort definition is done, and we can create the full object in Capr as so:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">T2DMPhenotype</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCohortDefinition.html">createCohortDefinition</a></span><span class="op">(</span>
  Name <span class="op">=</span> <span class="st">"PheKB T2DM Definition"</span>,
  PrimaryCriteria <span class="op">=</span> <span class="va">PrimaryCriteria</span>,
  AdditionalCriteria <span class="op">=</span> <span class="va">AdditionalCriteria</span>,
  InclusionRules <span class="op">=</span> <span class="va">InclusionRules</span>,
  CensoringCriteria <span class="op">=</span> <span class="va">CensoringCriteria</span>
<span class="op">)</span></code></pre></div>
<p>If we wanted to get the json from the cohort we can do so by compiling the cohort in the circe-be engine. From here we can use <code>CirceR</code> and <code>DatabaseConnector</code> to run the cohort definition query against the database to generate counts (this step is skipped).</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">T2DMPhenotypeJson</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compileCohortDefinition.html">compileCohortDefinition</a></span><span class="op">(</span><span class="va">T2DMPhenotype</span><span class="op">)</span></code></pre></div>
<p>If we wanted to check that this is a valid cohort, we can copy the json output into ATLAS.</p>
<pre><code>{
 "ConceptSets": [
 {
 "id": 0,
"name": "Type 2 Diabetes Diagnosis",
"expression": {
 "items": [
 {
 "concept": {
 "CONCEPT_ID": 201826,
"CONCEPT_NAME": "Type 2 diabetes mellitus",
"STANDARD_CONCEPT": "S",
"STANDARD_CONCEPT_CAPTION": "Standard",
"INVALID_REASON": "V",
"INVALID_REASON_CAPTION": "Valid",
"CONCEPT_CODE": "44054006",
"DOMAIN_ID": "Condition",
"VOCABULARY_ID": "SNOMED",
"CONCEPT_CLASS_ID": "Clinical Finding" 
},
"includeDescendants": true 
} 
] 
} 
},
{
 "id": 1,
"name": "Type 2 Diabetes Medications",
"expression": {
 "items": [
 {
 "concept": {
 "CONCEPT_ID": 1594973,
"CONCEPT_NAME": "chlorpropamide",
"STANDARD_CONCEPT": "S",
"STANDARD_CONCEPT_CAPTION": "Standard",
"INVALID_REASON": "V",
"INVALID_REASON_CAPTION": "Valid",
"CONCEPT_CODE": "2404",
"DOMAIN_ID": "Drug",
"VOCABULARY_ID": "RxNorm",
"CONCEPT_CLASS_ID": "Ingredient" 
},
"includeDescendants": true 
},
{
 "concept": {
 "CONCEPT_ID": 1515249,
"CONCEPT_NAME": "troglitazone",
"STANDARD_CONCEPT": "S",
"STANDARD_CONCEPT_CAPTION": "Standard",
"INVALID_REASON": "V",
"INVALID_REASON_CAPTION": "Valid",
"CONCEPT_CODE": "72610",
"DOMAIN_ID": "Drug",
"VOCABULARY_ID": "RxNorm",
"CONCEPT_CLASS_ID": "Ingredient" 
},
"includeDescendants": true 
},
{
 "concept": {
 "CONCEPT_ID": 1580747,
"CONCEPT_NAME": "sitagliptin",
"STANDARD_CONCEPT": "S",
"STANDARD_CONCEPT_CAPTION": "Standard",
"INVALID_REASON": "V",
"INVALID_REASON_CAPTION": "Valid",
"CONCEPT_CODE": "593411",
"DOMAIN_ID": "Drug",
"VOCABULARY_ID": "RxNorm",
"CONCEPT_CLASS_ID": "Ingredient" 
},
"includeDescendants": true 
},
{
 "concept": {
 "CONCEPT_ID": 1597756,
"CONCEPT_NAME": "glimepiride",
"STANDARD_CONCEPT": "S",
"STANDARD_CONCEPT_CAPTION": "Standard",
"INVALID_REASON": "V",
"INVALID_REASON_CAPTION": "Valid",
"CONCEPT_CODE": "25789",
"DOMAIN_ID": "Drug",
"VOCABULARY_ID": "RxNorm",
"CONCEPT_CLASS_ID": "Ingredient" 
},
"includeDescendants": true 
},
{
 "concept": {
 "CONCEPT_ID": 1525215,
"CONCEPT_NAME": "pioglitazone",
"STANDARD_CONCEPT": "S",
"STANDARD_CONCEPT_CAPTION": "Standard",
"INVALID_REASON": "V",
"INVALID_REASON_CAPTION": "Valid",
"CONCEPT_CODE": "33738",
"DOMAIN_ID": "Drug",
"VOCABULARY_ID": "RxNorm",
"CONCEPT_CLASS_ID": "Ingredient" 
},
"includeDescendants": true 
},
{
 "concept": {
 "CONCEPT_ID": 1510202,
"CONCEPT_NAME": "miglitol",
"STANDARD_CONCEPT": "S",
"STANDARD_CONCEPT_CAPTION": "Standard",
"INVALID_REASON": "V",
"INVALID_REASON_CAPTION": "Valid",
"CONCEPT_CODE": "30009",
"DOMAIN_ID": "Drug",
"VOCABULARY_ID": "RxNorm",
"CONCEPT_CLASS_ID": "Ingredient" 
},
"includeDescendants": true 
},
{
 "concept": {
 "CONCEPT_ID": 1530014,
"CONCEPT_NAME": "acetohexamide",
"STANDARD_CONCEPT": "S",
"STANDARD_CONCEPT_CAPTION": "Standard",
"INVALID_REASON": "V",
"INVALID_REASON_CAPTION": "Valid",
"CONCEPT_CODE": "173",
"DOMAIN_ID": "Drug",
"VOCABULARY_ID": "RxNorm",
"CONCEPT_CLASS_ID": "Ingredient" 
},
"includeDescendants": true 
},
{
 "concept": {
 "CONCEPT_ID": 1502826,
"CONCEPT_NAME": "nateglinide",
"STANDARD_CONCEPT": "S",
"STANDARD_CONCEPT_CAPTION": "Standard",
"INVALID_REASON": "V",
"INVALID_REASON_CAPTION": "Valid",
"CONCEPT_CODE": "274332",
"DOMAIN_ID": "Drug",
"VOCABULARY_ID": "RxNorm",
"CONCEPT_CLASS_ID": "Ingredient" 
},
"includeDescendants": true 
},
{
 "concept": {
 "CONCEPT_ID": 1503297,
"CONCEPT_NAME": "metformin",
"STANDARD_CONCEPT": "S",
"STANDARD_CONCEPT_CAPTION": "Standard",
"INVALID_REASON": "V",
"INVALID_REASON_CAPTION": "Valid",
"CONCEPT_CODE": "6809",
"DOMAIN_ID": "Drug",
"VOCABULARY_ID": "RxNorm",
"CONCEPT_CLASS_ID": "Ingredient" 
},
"includeDescendants": true 
},
{
 "concept": {
 "CONCEPT_ID": 1502809,
"CONCEPT_NAME": "tolazamide",
"STANDARD_CONCEPT": "S",
"STANDARD_CONCEPT_CAPTION": "Standard",
"INVALID_REASON": "V",
"INVALID_REASON_CAPTION": "Valid",
"CONCEPT_CODE": "10633",
"DOMAIN_ID": "Drug",
"VOCABULARY_ID": "RxNorm",
"CONCEPT_CLASS_ID": "Ingredient" 
},
"includeDescendants": true 
},
{
 "concept": {
 "CONCEPT_ID": 1560171,
"CONCEPT_NAME": "glipizide",
"STANDARD_CONCEPT": "S",
"STANDARD_CONCEPT_CAPTION": "Standard",
"INVALID_REASON": "V",
"INVALID_REASON_CAPTION": "Valid",
"CONCEPT_CODE": "4821",
"DOMAIN_ID": "Drug",
"VOCABULARY_ID": "RxNorm",
"CONCEPT_CLASS_ID": "Ingredient" 
},
"includeDescendants": true 
},
{
 "concept": {
 "CONCEPT_ID": 1583722,
"CONCEPT_NAME": "exenatide",
"STANDARD_CONCEPT": "S",
"STANDARD_CONCEPT_CAPTION": "Standard",
"INVALID_REASON": "V",
"INVALID_REASON_CAPTION": "Valid",
"CONCEPT_CODE": "60548",
"DOMAIN_ID": "Drug",
"VOCABULARY_ID": "RxNorm",
"CONCEPT_CLASS_ID": "Ingredient" 
},
"includeDescendants": true 
},
{
 "concept": {
 "CONCEPT_ID": 1529331,
"CONCEPT_NAME": "acarbose",
"STANDARD_CONCEPT": "S",
"STANDARD_CONCEPT_CAPTION": "Standard",
"INVALID_REASON": "V",
"INVALID_REASON_CAPTION": "Valid",
"CONCEPT_CODE": "16681",
"DOMAIN_ID": "Drug",
"VOCABULARY_ID": "RxNorm",
"CONCEPT_CLASS_ID": "Ingredient" 
},
"includeDescendants": true 
},
{
 "concept": {
 "CONCEPT_ID": 1547504,
"CONCEPT_NAME": "rosiglitazone",
"STANDARD_CONCEPT": "S",
"STANDARD_CONCEPT_CAPTION": "Standard",
"INVALID_REASON": "V",
"INVALID_REASON_CAPTION": "Valid",
"CONCEPT_CODE": "84108",
"DOMAIN_ID": "Drug",
"VOCABULARY_ID": "RxNorm",
"CONCEPT_CLASS_ID": "Ingredient" 
},
"includeDescendants": true 
},
{
 "concept": {
 "CONCEPT_ID": 1559684,
"CONCEPT_NAME": "glyburide",
"STANDARD_CONCEPT": "S",
"STANDARD_CONCEPT_CAPTION": "Standard",
"INVALID_REASON": "V",
"INVALID_REASON_CAPTION": "Valid",
"CONCEPT_CODE": "4815",
"DOMAIN_ID": "Drug",
"VOCABULARY_ID": "RxNorm",
"CONCEPT_CLASS_ID": "Ingredient" 
},
"includeDescendants": true 
},
{
 "concept": {
 "CONCEPT_ID": 1516766,
"CONCEPT_NAME": "repaglinide",
"STANDARD_CONCEPT": "S",
"STANDARD_CONCEPT_CAPTION": "Standard",
"INVALID_REASON": "V",
"INVALID_REASON_CAPTION": "Valid",
"CONCEPT_CODE": "73044",
"DOMAIN_ID": "Drug",
"VOCABULARY_ID": "RxNorm",
"CONCEPT_CLASS_ID": "Ingredient" 
},
"includeDescendants": true 
} 
] 
} 
},
{
 "id": 2,
"name": "Abnormal Lab HbA1c",
"expression": {
 "items": [
 {
 "concept": {
 "CONCEPT_ID": 3004410,
"CONCEPT_NAME": "Hemoglobin A1c/Hemoglobin.total in Blood",
"STANDARD_CONCEPT": "S",
"STANDARD_CONCEPT_CAPTION": "Standard",
"INVALID_REASON": "V",
"INVALID_REASON_CAPTION": "Valid",
"CONCEPT_CODE": "4548-4",
"DOMAIN_ID": "Measurement",
"VOCABULARY_ID": "LOINC",
"CONCEPT_CLASS_ID": "Lab Test" 
},
"includeDescendants": true 
},
{
 "concept": {
 "CONCEPT_ID": 3003309,
"CONCEPT_NAME": "Hemoglobin A1c/Hemoglobin.total in Blood by Electrophoresis",
"STANDARD_CONCEPT": "S",
"STANDARD_CONCEPT_CAPTION": "Standard",
"INVALID_REASON": "V",
"INVALID_REASON_CAPTION": "Valid",
"CONCEPT_CODE": "4549-2",
"DOMAIN_ID": "Measurement",
"VOCABULARY_ID": "LOINC",
"CONCEPT_CLASS_ID": "Lab Test" 
},
"includeDescendants": true 
},
{
 "concept": {
 "CONCEPT_ID": 3007263,
"CONCEPT_NAME": "Hemoglobin A1c/Hemoglobin.total in Blood by calculation",
"STANDARD_CONCEPT": "S",
"STANDARD_CONCEPT_CAPTION": "Standard",
"INVALID_REASON": "V",
"INVALID_REASON_CAPTION": "Valid",
"CONCEPT_CODE": "17855-8",
"DOMAIN_ID": "Measurement",
"VOCABULARY_ID": "LOINC",
"CONCEPT_CLASS_ID": "Lab Test" 
},
"includeDescendants": true 
},
{
 "concept": {
 "CONCEPT_ID": 3005673,
"CONCEPT_NAME": "Hemoglobin A1c/Hemoglobin.total in Blood by HPLC",
"STANDARD_CONCEPT": "S",
"STANDARD_CONCEPT_CAPTION": "Standard",
"INVALID_REASON": "V",
"INVALID_REASON_CAPTION": "Valid",
"CONCEPT_CODE": "17856-6",
"DOMAIN_ID": "Measurement",
"VOCABULARY_ID": "LOINC",
"CONCEPT_CLASS_ID": "Lab Test" 
},
"includeDescendants": true 
} 
] 
} 
},
{
 "id": 3,
"name": "Abnormal Lab Fasting Glucose",
"expression": {
 "items": [
 {
 "concept": {
 "CONCEPT_ID": 3037110,
"CONCEPT_NAME": "Fasting glucose [Mass/volume] in Serum or Plasma",
"STANDARD_CONCEPT": "S",
"STANDARD_CONCEPT_CAPTION": "Standard",
"INVALID_REASON": "V",
"INVALID_REASON_CAPTION": "Valid",
"CONCEPT_CODE": "1558-6",
"DOMAIN_ID": "Measurement",
"VOCABULARY_ID": "LOINC",
"CONCEPT_CLASS_ID": "Lab Test" 
},
"includeDescendants": true 
} 
] 
} 
},
{
 "id": 4,
"name": "Abnormal Lab Random Glucose",
"expression": {
 "items": [
 {
 "concept": {
 "CONCEPT_ID": 3000483,
"CONCEPT_NAME": "Glucose [Mass/volume] in Blood",
"STANDARD_CONCEPT": "S",
"STANDARD_CONCEPT_CAPTION": "Standard",
"INVALID_REASON": "V",
"INVALID_REASON_CAPTION": "Valid",
"CONCEPT_CODE": "2339-0",
"DOMAIN_ID": "Measurement",
"VOCABULARY_ID": "LOINC",
"CONCEPT_CLASS_ID": "Lab Test" 
},
"includeDescendants": true 
},
{
 "concept": {
 "CONCEPT_ID": 3004501,
"CONCEPT_NAME": "Glucose [Mass/volume] in Serum or Plasma",
"STANDARD_CONCEPT": "S",
"STANDARD_CONCEPT_CAPTION": "Standard",
"INVALID_REASON": "V",
"INVALID_REASON_CAPTION": "Valid",
"CONCEPT_CODE": "2345-7",
"DOMAIN_ID": "Measurement",
"VOCABULARY_ID": "LOINC",
"CONCEPT_CLASS_ID": "Lab Test" 
},
"includeDescendants": true 
} 
] 
} 
},
{
 "id": 5,
"name": "Type 1 Diabetes Diagnosis",
"expression": {
 "items": [
 {
 "concept": {
 "CONCEPT_ID": 201254,
"CONCEPT_NAME": "Type 1 diabetes mellitus",
"STANDARD_CONCEPT": "S",
"STANDARD_CONCEPT_CAPTION": "Standard",
"INVALID_REASON": "V",
"INVALID_REASON_CAPTION": "Valid",
"CONCEPT_CODE": "46635009",
"DOMAIN_ID": "Condition",
"VOCABULARY_ID": "SNOMED",
"CONCEPT_CLASS_ID": "Clinical Finding" 
},
"includeDescendants": true 
} 
] 
} 
},
{
 "id": 6,
"name": "Type 1 Diabetes Medications",
"expression": {
 "items": [
 {
 "concept": {
 "CONCEPT_ID": 1516976,
"CONCEPT_NAME": "insulin detemir",
"STANDARD_CONCEPT": "S",
"STANDARD_CONCEPT_CAPTION": "Standard",
"INVALID_REASON": "V",
"INVALID_REASON_CAPTION": "Valid",
"CONCEPT_CODE": "139825",
"DOMAIN_ID": "Drug",
"VOCABULARY_ID": "RxNorm",
"CONCEPT_CLASS_ID": "Ingredient" 
},
"includeDescendants": true 
},
{
 "concept": {
 "CONCEPT_ID": 1550023,
"CONCEPT_NAME": "insulin lispro",
"STANDARD_CONCEPT": "S",
"STANDARD_CONCEPT_CAPTION": "Standard",
"INVALID_REASON": "V",
"INVALID_REASON_CAPTION": "Valid",
"CONCEPT_CODE": "86009",
"DOMAIN_ID": "Drug",
"VOCABULARY_ID": "RxNorm",
"CONCEPT_CLASS_ID": "Ingredient" 
},
"includeDescendants": true 
},
{
 "concept": {
 "CONCEPT_ID": 1513876,
"CONCEPT_NAME": "insulin lispro protamine, human",
"STANDARD_CONCEPT": "S",
"STANDARD_CONCEPT_CAPTION": "Standard",
"INVALID_REASON": "V",
"INVALID_REASON_CAPTION": "Valid",
"CONCEPT_CODE": "314684",
"DOMAIN_ID": "Drug",
"VOCABULARY_ID": "RxNorm",
"CONCEPT_CLASS_ID": "Ingredient" 
},
"includeDescendants": true 
},
{
 "concept": {
 "CONCEPT_ID": 1544838,
"CONCEPT_NAME": "insulin glulisine, human",
"STANDARD_CONCEPT": "S",
"STANDARD_CONCEPT_CAPTION": "Standard",
"INVALID_REASON": "V",
"INVALID_REASON_CAPTION": "Valid",
"CONCEPT_CODE": "400008",
"DOMAIN_ID": "Drug",
"VOCABULARY_ID": "RxNorm",
"CONCEPT_CLASS_ID": "Ingredient" 
},
"includeDescendants": true 
},
{
 "concept": {
 "CONCEPT_ID": 1502905,
"CONCEPT_NAME": "insulin glargine",
"STANDARD_CONCEPT": "S",
"STANDARD_CONCEPT_CAPTION": "Standard",
"INVALID_REASON": "V",
"INVALID_REASON_CAPTION": "Valid",
"CONCEPT_CODE": "274783",
"DOMAIN_ID": "Drug",
"VOCABULARY_ID": "RxNorm",
"CONCEPT_CLASS_ID": "Ingredient" 
},
"includeDescendants": true 
},
{
 "concept": {
 "CONCEPT_ID": 1517998,
"CONCEPT_NAME": "pramlintide",
"STANDARD_CONCEPT": "S",
"STANDARD_CONCEPT_CAPTION": "Standard",
"INVALID_REASON": "V",
"INVALID_REASON_CAPTION": "Valid",
"CONCEPT_CODE": "139953",
"DOMAIN_ID": "Drug",
"VOCABULARY_ID": "RxNorm",
"CONCEPT_CLASS_ID": "Ingredient" 
},
"includeDescendants": true 
},
{
 "concept": {
 "CONCEPT_ID": 1531601,
"CONCEPT_NAME": "insulin aspart protamine, human",
"STANDARD_CONCEPT": "S",
"STANDARD_CONCEPT_CAPTION": "Standard",
"INVALID_REASON": "V",
"INVALID_REASON_CAPTION": "Valid",
"CONCEPT_CODE": "352385",
"DOMAIN_ID": "Drug",
"VOCABULARY_ID": "RxNorm",
"CONCEPT_CLASS_ID": "Ingredient" 
},
"includeDescendants": true 
},
{
 "concept": {
 "CONCEPT_ID": 1567198,
"CONCEPT_NAME": "insulin aspart, human",
"STANDARD_CONCEPT": "S",
"STANDARD_CONCEPT_CAPTION": "Standard",
"INVALID_REASON": "V",
"INVALID_REASON_CAPTION": "Valid",
"CONCEPT_CODE": "51428",
"DOMAIN_ID": "Drug",
"VOCABULARY_ID": "RxNorm",
"CONCEPT_CLASS_ID": "Ingredient" 
},
"includeDescendants": true 
} 
] 
} 
} 
],
"PrimaryCriteria": {
 "CriteriaList": [
 {
 "ConditionOccurrence": {
 "CodesetId": 0 
} 
},
{
 "DrugExposure": {
 "CodesetId": 1 
} 
},
{
 "Measurement": {
 "CodesetId": 2,
"ValueAsNumber": {
 "Value": 6,
"Op": "gte" 
} 
} 
},
{
 "Measurement": {
 "CodesetId": 3,
"ValueAsNumber": {
 "Value": 125,
"Op": "gte" 
} 
} 
},
{
 "Measurement": {
 "CodesetId": 4,
"ValueAsNumber": {
 "Value": 200,
"Op": "gte" 
} 
} 
} 
],
"ObservationWindow": {
 "PriorDays": 0,
"PostDays": 0 
},
"PrimaryCriteriaLimit": {
 "Type": "All" 
} 
},
"AdditionalCriteria": {
 "Type": "ALL",
"CriteriaList": [
 {
 "Criteria": {
 "ConditionOccurrence": {
 "CodesetId": 5 
} 
},
"StartWindow": {
 "Start": {
 "Coeff": -1 
},
"End": {
 "Days": 0,
"Coeff": 1 
},
"UseEventEnd": false,
"UseIndexEnd": false 
},
"Occurrence": {
 "Type": 0,
"Count": 0 
} 
} 
],
"DemographicCriteriaList": [],
"Groups": [] 
},
"QualifiedLimit": {
 "Type": "First" 
},
"ExpressionLimit": {
 "Type": "First" 
},
"InclusionRules": [
 {
 "name": "Case for T2DM using algorithm",
"expression": {
 "Type": "ANY",
"CriteriaList": [],
"DemographicCriteriaList": [],
"Groups": [
 {
 "Type": "ALL",
"CriteriaList": [
 {
 "Criteria": {
 "ConditionOccurrence": {
 "CodesetId": 0 
} 
},
"StartWindow": {
 "Start": {
 "Coeff": -1 
},
"End": {
 "Days": 0,
"Coeff": 1 
},
"UseEventEnd": false,
"UseIndexEnd": false 
},
"Occurrence": {
 "Type": 0,
"Count": 0 
} 
},
{
 "Criteria": {
 "DrugExposure": {
 "CodesetId": 1 
} 
},
"StartWindow": {
 "Start": {
 "Coeff": -1 
},
"End": {
 "Days": 0,
"Coeff": 1 
},
"UseEventEnd": false,
"UseIndexEnd": false 
},
"Occurrence": {
 "Type": 2,
"Count": 1 
} 
} 
],
"DemographicCriteriaList": [],
"Groups": [
 {
 "Type": "ANY",
"CriteriaList": [
 {
 "Criteria": {
 "Measurement": {
 "CodesetId": 2,
"ValueAsNumber": {
 "Value": 6,
"Op": "gte" 
} 
} 
},
"StartWindow": {
 "Start": {
 "Coeff": -1 
},
"End": {
 "Days": 0,
"Coeff": 1 
},
"UseEventEnd": false,
"UseIndexEnd": false 
},
"Occurrence": {
 "Type": 2,
"Count": 1 
} 
},
{
 "Criteria": {
 "Measurement": {
 "CodesetId": 3,
"ValueAsNumber": {
 "Value": 125,
"Op": "gte" 
} 
} 
},
"StartWindow": {
 "Start": {
 "Coeff": -1 
},
"End": {
 "Days": 0,
"Coeff": 1 
},
"UseEventEnd": false,
"UseIndexEnd": false 
},
"Occurrence": {
 "Type": 2,
"Count": 1 
} 
},
{
 "Criteria": {
 "Measurement": {
 "CodesetId": 4,
"ValueAsNumber": {
 "Value": 200,
"Op": "gte" 
} 
} 
},
"StartWindow": {
 "Start": {
 "Coeff": -1 
},
"End": {
 "Days": 0,
"Coeff": 1 
},
"UseEventEnd": false,
"UseIndexEnd": false 
},
"Occurrence": {
 "Type": 2,
"Count": 1 
} 
} 
],
"DemographicCriteriaList": [],
"Groups": [] 
} 
] 
},
{
 "Type": "ALL",
"CriteriaList": [
 {
 "Criteria": {
 "ConditionOccurrence": {
 "CodesetId": 0 
} 
},
"StartWindow": {
 "Start": {
 "Coeff": -1 
},
"End": {
 "Days": 0,
"Coeff": 1 
},
"UseEventEnd": false,
"UseIndexEnd": false 
},
"Occurrence": {
 "Type": 2,
"Count": 1 
} 
},
{
 "Criteria": {
 "DrugExposure": {
 "CodesetId": 6 
} 
},
"StartWindow": {
 "Start": {
 "Coeff": -1 
},
"End": {
 "Days": 0,
"Coeff": 1 
},
"UseEventEnd": false,
"UseIndexEnd": false 
},
"Occurrence": {
 "Type": 0,
"Count": 0 
} 
},
{
 "Criteria": {
 "DrugExposure": {
 "CodesetId": 1 
} 
},
"StartWindow": {
 "Start": {
 "Coeff": -1 
},
"End": {
 "Days": 0,
"Coeff": 1 
},
"UseEventEnd": false,
"UseIndexEnd": false 
},
"Occurrence": {
 "Type": 0,
"Count": 0 
} 
} 
],
"DemographicCriteriaList": [],
"Groups": [
 {
 "Type": "ANY",
"CriteriaList": [
 {
 "Criteria": {
 "Measurement": {
 "CodesetId": 2,
"ValueAsNumber": {
 "Value": 6,
"Op": "gte" 
} 
} 
},
"StartWindow": {
 "Start": {
 "Coeff": -1 
},
"End": {
 "Days": 0,
"Coeff": 1 
},
"UseEventEnd": false,
"UseIndexEnd": false 
},
"Occurrence": {
 "Type": 2,
"Count": 1 
} 
},
{
 "Criteria": {
 "Measurement": {
 "CodesetId": 3,
"ValueAsNumber": {
 "Value": 125,
"Op": "gte" 
} 
} 
},
"StartWindow": {
 "Start": {
 "Coeff": -1 
},
"End": {
 "Days": 0,
"Coeff": 1 
},
"UseEventEnd": false,
"UseIndexEnd": false 
},
"Occurrence": {
 "Type": 2,
"Count": 1 
} 
},
{
 "Criteria": {
 "Measurement": {
 "CodesetId": 4,
"ValueAsNumber": {
 "Value": 200,
"Op": "gte" 
} 
} 
},
"StartWindow": {
 "Start": {
 "Coeff": -1 
},
"End": {
 "Days": 0,
"Coeff": 1 
},
"UseEventEnd": false,
"UseIndexEnd": false 
},
"Occurrence": {
 "Type": 2,
"Count": 1 
} 
} 
],
"DemographicCriteriaList": [],
"Groups": [] 
} 
] 
},
{
 "Type": "ALL",
"CriteriaList": [
 {
 "Criteria": {
 "ConditionOccurrence": {
 "CodesetId": 0 
} 
},
"StartWindow": {
 "Start": {
 "Coeff": -1 
},
"End": {
 "Days": 0,
"Coeff": 1 
},
"UseEventEnd": false,
"UseIndexEnd": false 
},
"Occurrence": {
 "Type": 2,
"Count": 1 
} 
},
{
 "Criteria": {
 "DrugExposure": {
 "CodesetId": 6 
} 
},
"StartWindow": {
 "Start": {
 "Coeff": -1 
},
"End": {
 "Days": 0,
"Coeff": 1 
},
"UseEventEnd": false,
"UseIndexEnd": false 
},
"Occurrence": {
 "Type": 0,
"Count": 0 
} 
},
{
 "Criteria": {
 "DrugExposure": {
 "CodesetId": 1 
} 
},
"StartWindow": {
 "Start": {
 "Coeff": -1 
},
"End": {
 "Days": 0,
"Coeff": 1 
},
"UseEventEnd": false,
"UseIndexEnd": false 
},
"Occurrence": {
 "Type": 2,
"Count": 1 
} 
} 
],
"DemographicCriteriaList": [],
"Groups": [] 
},
{
 "Type": "ALL",
"CriteriaList": [
 {
 "Criteria": {
 "ConditionOccurrence": {
 "CodesetId": 0 
} 
},
"StartWindow": {
 "Start": {
 "Coeff": -1 
},
"End": {
 "Days": 0,
"Coeff": 1 
},
"UseEventEnd": false,
"UseIndexEnd": false 
},
"Occurrence": {
 "Type": 2,
"Count": 1 
} 
},
{
 "Criteria": {
 "DrugExposure": {
 "CodesetId": 6 
} 
},
"StartWindow": {
 "Start": {
 "Coeff": -1 
},
"End": {
 "Days": 0,
"Coeff": 1 
},
"UseEventEnd": false,
"UseIndexEnd": false 
},
"Occurrence": {
 "Type": 2,
"Count": 1 
} 
},
{
 "Criteria": {
 "DrugExposure": {
 "CodesetId": 6,
"CorrelatedCriteria": {
 "Type": "ALL",
"CriteriaList": [
 {
 "Criteria": {
 "DrugExposure": {
 "CodesetId": 1 
} 
},
"StartWindow": {
 "Start": {
 "Coeff": -1 
},
"End": {
 "Days": 1,
"Coeff": -1 
},
"UseEventEnd": false,
"UseIndexEnd": false 
},
"Occurrence": {
 "Type": 2,
"Count": 1 
} 
} 
],
"DemographicCriteriaList": [],
"Groups": [] 
} 
} 
},
"StartWindow": {
 "Start": {
 "Coeff": -1 
},
"End": {
 "Days": 0,
"Coeff": 1 
},
"UseEventEnd": false,
"UseIndexEnd": false 
},
"Occurrence": {
 "Type": 2,
"Count": 1 
} 
} 
],
"DemographicCriteriaList": [],
"Groups": [] 
},
{
 "Type": "ALL",
"CriteriaList": [
 {
 "Criteria": {
 "ConditionOccurrence": {
 "CodesetId": 0 
} 
},
"StartWindow": {
 "Start": {
 "Coeff": -1 
},
"End": {
 "Days": 0,
"Coeff": 1 
},
"UseEventEnd": false,
"UseIndexEnd": false 
},
"Occurrence": {
 "Type": 2,
"Count": 1 
} 
},
{
 "Criteria": {
 "DrugExposure": {
 "CodesetId": 6 
} 
},
"StartWindow": {
 "Start": {
 "Coeff": -1 
},
"End": {
 "Days": 0,
"Coeff": 1 
},
"UseEventEnd": false,
"UseIndexEnd": false 
},
"Occurrence": {
 "Type": 2,
"Count": 1 
} 
},
{
 "Criteria": {
 "DrugExposure": {
 "CodesetId": 1 
} 
},
"StartWindow": {
 "Start": {
 "Coeff": -1 
},
"End": {
 "Days": 0,
"Coeff": 1 
},
"UseEventEnd": false,
"UseIndexEnd": false 
},
"Occurrence": {
 "Type": 0,
"Count": 0 
} 
},
{
 "Criteria": {
 "ConditionOccurrence": {
 "CodesetId": 0 
} 
},
"StartWindow": {
 "Start": {
 "Coeff": -1 
},
"End": {
 "Days": 0,
"Coeff": 1 
},
"UseEventEnd": false,
"UseIndexEnd": false 
},
"Occurrence": {
 "Type": 2,
"Count": 2 
} 
} 
],
"DemographicCriteriaList": [],
"Groups": [] 
} 
] 
} 
} 
],
"CensoringCriteria": [
 {
 "ConditionOccurrence": {
 "CodesetId": 5 
} 
} 
],
"CollapseSettings": {
 "CollapseType": "ERA",
"EraPad": 0 
},
"CensorWindow": {},
"cdmVersionRange": "&gt;=5.0.0" 
}</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Martin Lavallee.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
